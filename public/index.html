<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        .row .col-md-4 {
            margin: 15px 0;
        }

        .nav-pills .nav-link {
            color: white !important;
        }

        .QR_Generate .col-md-5 {
            height: 100%;
            margin: auto 0;
        }

        .QR_Generate input {
            width: 100%;
            margin-bottom: 7px;
        }

        .card {
            height: 100%;
        }

        .card img {

            height: 250px;
            object-fit: contain;
        }

        @media (max-width: 540px) {
            h3 {
                font-size: 18px;
            }

            .Tabs-container ul li {
                font-size: 12px;
                padding: 0;
            }

            .login-form {
                width: 90%;
                font-size: 14px;
            }
        }

        .login-page {
            width: 100vw;
            height: 100dvh;
            top: 0;
            left: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: white;
            position: fixed;

        }

        .login-form {
            min-width: 50%;

            margin: 0 auto;
            padding: 45px 25px;
            box-shadow: 0px 0px 5px 5px rgba(228, 228, 228, 0.671);
        }

        .login-form h3 {
            font-size: 36px;
            text-align: center;
            padding-bottom: 35px;
        }

        .login-form form {
            width: 80%;
            display: flex;
            flex-direction: column;
            margin: 0 auto;
            gap: 15px 0;
            font-size: 20px;
        }

        .login-form label {
            text-transform: capitalize;
        }

        .login-form input {
            padding: 10px 5px;
            font-size: 18px;
        }

        .login-form input[type="submit"] {
            background-color: rgb(219, 219, 219);
            color: black;
            font-weight: 600;
            text-transform: uppercase;
        }
    </style>
</head>

<body>

    <section class="main-website-content">
        <div class=" px-3 bg-secondary text-white navigation py-3 d-flex justify-content-between">
            <div class="logo d-flex align-items-center justify-content-center">
                <h3 class="">QR Generator</h3>
            </div>
            <div class="Tabs-container !text-black">
                <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home"
                            aria-selected="true">Uploads</button>
                    </li>

                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill"
                            data-bs-target="#pills-contact" type="button" role="tab" aria-controls="pills-contact"
                            aria-selected="false">Added Files</button>
                    </li>
                    <li>
                        <button class="nav-link" style="font-weight: 700;" onclick="handleLogut()">
                            logout
                        </button>
                    </li>
                </ul>
            </div>
        </div>

        <div class="main-content-body pt-5">
            <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab"
                    tabindex="0">
                    <section class="QR_Generate">
                        <div class="container  d-flex justify-content-between">
                            <div class="col-md-5 mx-auto my-auto col-sm-12">
                                <span>
                                    <h3>Upload Something</h3>
                                    <br><br>
                                </span>

                                <div
                                    class="QR-inputbox py-5 px-2 h-full d-flex align-items-center justify-content-center card">

                                    <div class="w-100">
                                        <form class="controls w-full" action="http://localhost:3000/uploadImages"
                                            method="POST" enctype="multipart/form-data">
                                            <!-- <input type="text" placeholder="File Name" class="form-control" name="name" id="text" required> -->
                                            <input type="file" placeholder="Paste the Url" class="form-control"
                                                name="image" id="image" required>
                                            <input type="submit" value="Upload File"
                                                class="form-control bg-primary text-white mt-3">
                                        </form>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab"
                    tabindex="0">

                    <section>
                        <div class="added-files-cotnainer col-10 offset-1">
                            <span class="text-center pb-5">
                                <h4>All Added files</h4><br>
                            </span>
                            <div class="row" id="img-row">

                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>




        <div class="login-page">
            <div class="login-form">
                <h3>Login please</h3>
                <form onsubmit="">
                    <p id="error"></p>
                    <div>
                        <label for="number">number</label><br>
                        <input type="number" placeholder="Type your Number" name="number" id="number"
                            class="form-control">
                    </div>
                    <div>
                        <label for="passord">Password</label><br>
                        <input type="password" placeholder="Password" id="password" name="password"
                            class="form-control">
                    </div>
                    <span>
                        <input type="submit" onclick='LoginHandler()' value="Login" class="form-control" id="Submit">
                    </span>

                </form>
            </div>
        </div>
    </section>




    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
        integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
        crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.min.js" integrity="sha512-ykZ1QQr0Jy/4ZkvKuqWn4iF3lqPZyij9iRv6sGqLRdTPkY69YX6+7wvVGmsdBbiIfN/8OdsI7HABjvEok6ZopQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"
        integrity="sha512-BNaRQnYJYiPSqHHDb58B0yaPfCu+Wgds8Gp/gU33kqBtgNS4tSPHuGibyoeqMV/TJlSKda6FXzoEyYGjTe+vXA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        let row = "";
        fetch("http://localhost:3000/allImages")
            .then(res => res.json())
            .then(data => {
                data.forEach(async (image, i) => {
                    const { imgName, _id, imgUrl } = image;
                    const imageData = await toDataURL(`https://api.qrserver.com/v1/create-qr-code/?data=${imgUrl}`);

                    console.log(imageData)

                    row += `
                        <div class="col-md-4 col-sm-6" id=${i}>
                                <div class="card">                      
                                    <div class="p-2 QR-box">
                                       <img src="${imageData}" alt="QR-Code" class="img-fluid w-100">
                                    </div>
                                    <div class="card-footer d-flex justify-content-between">
                                      <a class="download" download href="${imageData}"> <button>download</button></a>
                                       <button onclick={deleteItem('${_id}')} >delete</button>                            
                                </div>
                             </div>
                        </div>
                    `
                    row ? document.getElementById("img-row").innerHTML = row : null;
                });
            })
            .catch(error => console.log(error))





    </script>

    <script>
        var number = document.getElementById("number").value;
        var password = document.getElementById("password").value;
        const login_form = document.querySelector(".login-page");
        const author = document.cookie;

        const submitBtn = document.querySelector("#Submit");
        const errordiv = document.querySelector("#error");
        var errorText = ""
        var LoginHandler = (event) => {
            event.preventDefault();

            var number = document.getElementById("number").value;
            var password = document.getElementById("password").value;


            fetch("http://localhost:3000/login_user", {
                method: "POST",
                headers: {
                    'content-type': "application/json",
                },
                body: JSON.stringify({
                    number,
                    password
                })

            }).then(response => response.json())
                .then(data => {
                    if (data.message) {
                        console.log(data)
                        errorText = data.message;
                        errordiv.innerText = errorText;
                        errordiv.style.color = "red";


                        const error = setTimeout(() => {
                            errordiv = " "
                        }, 3000);
                    }
                    else {
                        localStorage.setItem('user', "hello world!");
                        // login_form.style.display = "none";
                      window.location.reload();
                    }
                })
        }
        submitBtn.addEventListener("click", LoginHandler);


        window.addEventListener("DOMContentLoaded", () => {
            if (localStorage.getItem("user")) {
                login_form.style.display = "none";
            } else {
                login_form.style.display = "flex";
            }

        })
    </script>



    <script>
     const login_page= document.querySelector(".login-page");


        const handleLogut = () => {
            localStorage.removeItem('user');
            // alert("Logout was successful");
            window.location.reload();
        }   

        async function toDataURL(url) {
            const blob = await fetch(url).then(res => res.blob());
            return URL.createObjectURL(blob);
        }

        function deleteItem(itemId) {
            var ResponseData = "";
            if (confirm("Do you want to delete?") == true) {
                fetch(`http://localhost:3000/deleteImage/${itemId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log(data.message);
                        alert(data.message);
                        window.reload();
                    })
                    .catch(error => console.error('Error:', error));
                console.log("QR Deleted successfully")
            } else {
                console.log("not deleted")
            }

        }
    </script>
</body>

</html>